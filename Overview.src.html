<!doctype html>
<html lang=en-US>
<meta charset=utf-8>
<link rel=stylesheet href=//whatwg.org/style/specification>
<link rel=icon href=//resources.whatwg.org/logo-notifications.svg>
<title>Notifications API Standard</title>

<div class=head>

<p><a class=logo href=//whatwg.org/><img alt=WHATWG src=//resources.whatwg.org/logo-notifications.svg width=100 height=100></a></p>
<h1>Notifications API</h1>
<h2 class="no-num no-toc">Living Standard &mdash; Last Updated [DATE: 01 Jan 1901]</h2>

<dl>
 <dt>Participate:</dt>
 <dd>Send feedback to <a href="//whatwg.org/mailing-list">whatwg@whatwg.org</a>
 (<a href="http://lists.w3.org/Archives/Public/public-whatwg-archive/">archives</a>)
 or <a href="https://github.com/whatwg/notifications/issues/new">file an issue</a>
 (<a href="https://github.com/whatwg/notifications/issues">open issues</a>)
 <dd><a href="//wiki.whatwg.org/wiki/IRC">IRC: #whatwg on Freenode</a>

 <dt>Commits:
 <dd><a href=https://github.com/whatwg/notifications/commits>https://github.com/whatwg/notifications/commits</a>
 <dd><a href=https://twitter.com/notifyapi>@notifyapi</a>
  <!-- notificationsapi was too long, notifications taken -->
</dl>

<script src=https://resources.whatwg.org/file-issue.js async></script>

</div>



<h2 class="no-num no-toc">Table of contents</h2>

<!-- toc -->



<h2>Preface</h2>

<p>This standard defines an API to display notifications to the end user, typically
outside the top-level browsing context's viewport. It is designed to be compatible with
existing notification systems, while remaining platform-independent.



<h2>Conformance</h2>

<p>All diagrams, examples, and notes in this specification are
non-normative, as are all sections explicitly marked non-normative.
Everything else in this specification is normative.

<p>The key words "MUST", "MUST NOT", "REQUIRED", <!--"SHALL", "SHALL
NOT",--> "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and
"OPTIONAL" in the normative parts of this specification are to be
interpreted as described in RFC2119. For readability, these words do
not appear in all uppercase letters in this specification.
<span data-anolis-ref>RFC2119</span>



<h2>Terminology</h2>

<p>Terminology used in this specification is from DOM, Fetch, HTML, IDL, URL, and
Vibration API.
<span data-anolis-ref>DOM</span>
<span data-anolis-ref>FETCH</span>
<span data-anolis-ref>HTML</span>
<span data-anolis-ref>WEBIDL</span>
<span data-anolis-ref>URL</span>
<span data-anolis-ref>VIBRATION</span>


<h2>Notifications</h2>

<p>A <dfn title=concept-notification>notification</dfn> is an abstract representation of
an occurrence, such as the delivery of a message.

<p>A <span title=concept-notification>notification</span> has an associated
<dfn>title</dfn> which is a DOMString.

<p>A <span title=concept-notification>notification</span> has an associated
<dfn>body</dfn> which is a DOMString.

<p>A <span title=concept-notification>notification</span> has an associated
<dfn title=concept-notification-direction>direction</dfn> which is one of
<i title>auto</i>, <i title>ltr</i>, and <i title>rtl</i>.

<p>A <span title=concept-notification>notification</span> has an associated
<dfn title=concept-notification-language>language</dfn> which is a DOMString representing
either a valid BCP 47 language tag or the empty string.

<p>A <span title=concept-notification>notification</span> has an associated
<dfn>tag</dfn> which is a DOMString.

<p>A <span title=concept-notification>notification</span> has an associated
<dfn>data</dfn>.

<p>A <span title=concept-notification>notification</span> has an associated
<dfn title=concept-notification-origin>origin</dfn>.

<p>A <span title=concept-notification>notification</span> has an associated
<dfn>renotify preference flag</dfn> which is initially unset. When set indicates that the
end user should be alerted after the <span>replace steps</span> have run.

<p>A <span title=concept-notification>notification</span> has an associated
<dfn>silent preference flag</dfn> which is initially unset. When set indicates that no
sound should be made.

<p>A <span title=concept-notification>notification</span> has an associated
<dfn>screen off preference flag</dfn> which is initially unset. When set indicates that
the screen of the device should not be enabled.

<p>A <span title=concept-notification>notification</span> has an associated
<dfn>sticky preference flag</dfn> which is initially unset. When set indicates that the
end user should not be able to easily clear the
<span title=concept-notification>notification</span>. <span class=note>Only makes sense
for <span title=concept-persistent-notification>persistent notifications</span>.</span>

<p>A <span title=concept-notification>notification</span> <em>can</em>
have an associated <dfn>icon URL</dfn>, <dfn>icon resource</dfn>, <dfn>sound URL</dfn>,
<dfn>sound resource</dfn>, <dfn>vibration pattern</dfn>, and
<dfn title=concept-notification-service-worker-registration>service worker registration</dfn>.

<p>A <dfn title=concept-non-persistent-notification>non-persistent notification</dfn> is a
<span title=concept-notification>notification</span> without an associated
<span title=concept-notification-service-worker-registration>service worker registration</span>.

<p>A <dfn title=concept-persistent-notification>persistent notification</dfn> is a
<span title=concept-notification>notification</span> with an associated
<span title=concept-notification-service-worker-registration>service worker registration</span>.

<!-- XXX https://html.spec.whatwg.org/#fingerprinting-vector -->

<hr>

<p>To <dfn title=concept-notification-create>create a notification</dfn>, given a
<var title>title</var> and <var title>options</var>, run these steps:

<ol>
 <li><p>Let <var title>notification</var> be a new
 <span title=concept-notification>notification</span>.

 <!-- handle exception throwing stuff early -->
 <li><p>If <var title>options</var>'s <code title>silent</code> is true, and either
 <var title>options</var>'s <code title>sound</code> is present or
 <var title>options</var>'s <code title>vibrate</code> is present,
 <span data-anolis-spec=webidl>throw</span> a <code>TypeError</code> exception.

 <li><p>If <var title>options</var>'s <code title>renotify</code> is true and
 <var title>options</var>'s <code title>tag</code> is the empty string,
 <span data-anolis-spec=webidl>throw</span> a <code>TypeError</code> exception.

 <li><p>Set <var title>notification</var>'s <span>data</span> to a
 <span data-anolis-spec=html>structured clone</span> of
 <var title>options</var>'s <code title>data</code>. Rethrow any exceptions.
 <!-- end handling exception throwing stuff -->

 <li><p>Set <var title>notification</var>'s <span>title</span> to <var title>title</var>.

 <li><p>Set <var title>notification</var>'s
 <span title=concept-notification-direction>direction</span> to <var title>options</var>'s
 <code title>dir</code>.

 <li><p>If <var title>options</var>'s <code title>lang</code> is either a valid
 BCP 47 language tag or the empty string, set <var title>notification</var>'s
 <span title=concept-notification-language>language</span> to <var title>options</var>'s
 <code title>lang</code>, and set it to the empty string otherwise.
 <span data-anolis-ref>LANG</span>

 <li><p>Set <var title>notifications</var>'s
 <span title=concept-notification-origin>origin</span> to the
 <span data-anolis-spec=html>entry settings object</span>'s
 <span data-anolis-spec=html>origin</span>.

 <li><p>Set <var title>notification</var>'s <span>body</span> to
 <var title>options</var>'s <code title>body</code>.

 <li><p>Set <var title>notification</var>'s <span>tag</span> to
 <var title>options</var>'s <code title>tag</code>.

 <li><p>Let <var title>baseURL</var> be the
 <span data-anolis-spec=html>API base URL</span> specified by the
 <span data-anolis-spec=html>entry settings object</span>.
 <span class=XXX>Or incumbent?</span>

 <li><p>If <var title>options</var>'s <code title>icon</code> is present,
 <span title=concept-url-parser data-anolis-spec=url>parse</span> it using
 <var title>baseURL</var>, and if that does not return failure, set
 <var title>notification</var>'s <span>icon URL</span> to the return value. (Otherwise
 <span>icon URL</span> is not set.)

 <li><p>If <var title>options</var>'s <code title>sound</code> is present,
 <span title=concept-url-parser data-anolis-spec=url>parse</span> it
 using <var title>baseURL</var>, and if that does not return failure, set
 <var title>notification</var>'s <span>sound URL</span> to the return value. (Otherwise
 <span>sound URL</span> is not set.)

 <li><p>If <var title>options</var>'s <code title>vibrate</code> is present,
 <span data-anolis-spec=vibration>validate and normalize</span> it and set
 <var title>notification</var>'s <span>vibration pattern</span> to the return value.
 (Otherwise <span>vibration pattern</span> is not set.)

 <li><p>If <var title>options</var>'s <code title>renotify</code> is true, set
 <var title>notification</var>'s <span>renotify preference flag</span>.

 <li><p>If <var title>options</var>'s <code title>silent</code> is true, set
 <var title>notification</var>'s <span>silent preference flag</span>.

 <li><p>If <var title>options</var>'s <code title>noscreen</code> is true, set
 <var title>notification</var>'s <span>screen off preference flag</span>.

 <li><p>If <var title>options</var>'s <code title>sticky</code> is true, set
 <var title>notification</var>'s <span>sticky preference flag</span>.

 <li><p>Return <var title>notification</var>.
</ol>


<h3>Lifetime and UI integration</h3>

<p>The user agent must keep a <dfn>list of notifications</dfn> that consists of zero or
more <span title=concept-notification>notifications</span>.

<p>User agents should run the <span>close steps</span> for a
<span title=concept-non-persistent-notification>non-persistent notification</span> a
couple of seconds after they have been
<span title="create a notification">created</span>.

<p>User agents should not display
<span title=concept-non-persistent-notification>non-persistent notification</span> in a
platform's "notification center" (if available).

<p>User agents should persist
<span title=concept-persistent-notification>persistent notifications</span> until they are
removed from the <span>list of notifications</span>.

<p class=example>A
<span title=concept-persistent-notification>persistent notification</span> could have the
<code title=dom-Notification-close>close()</code> method invoked of one of its
<code>Notification</code> objects.

<p>User agents should display
<span title=concept-persistent-notification>persistent notification</span> in a
platform's "notification center" (if available).


<h3>Permission model</h3>

<p><span title=concept-notification>Notifications</span> can only be
displayed if the user (or user agent on behalf of the user) has granted
<dfn title=concept-permission>permission</dfn>. The
<span title=concept-permission>permission</span> to show
<span title=concept-notification>notifications</span> for a given
<span data-anolis-spec=html>origin</span> is one of three strings:

<dl>
 <dt>"<code title>default</code>"
 <dd><p>This is equivalent to "<code title>denied</code>", but the user has
 made no explicit choice thus far.

 <dt>"<code title>denied</code>"
 <dd><p>This means the user does not want
 <span title=concept-notification>notifications</span>.

 <dt>"<code title>granted</code>"
 <dd><p>This means <span title=concept-notification>notifications</span> can
 be displayed.
</dl>

<p class=note>There is no equivalent to "<code title>default</code>"
meaning "<code title>granted</code>". In that case
"<code title>granted</code>" is simply returned as there would be no reason
for the application to ask for <span title=concept-permission>permission</span>.


<h3>Direction</h3>

<p>This section is written in terms equivalent to those used in the
Rendering section of HTML. <span data-anolis-ref>HTML</span>

<!-- keep this in sync with
     https://html.spec.whatwg.org/multipage/rendering.html#text-rendered-in-native-user-interfaces -->

<p>User agents are expected to honor the Unicode semantics of the text of a
<span title=concept-notification>notification</span>'s <span>title</span>
and <span>body</span>. Each is expected to be treated as an independent set
of one or more bidirectional algorithm paragraphs when displayed, as defined
by the bidirectional algorithm's rules P1, P2, and P3, including, for
instance, supporting the paragraph-breaking behaviour of
U+000A LINE FEED (LF) characters. For each paragraph of the
<span>title</span> and <span>body</span>, the
<span title=concept-notification>notification</span>'s
<span title=concept-notification-direction>direction</span> provides the higher-level
override of rules P2 and P3 if it has a value other than "<code title>auto</code>".
<span data-anolis-ref>BIDI</span>


<h3>Language</h3>

<!-- keep this in sync with
     https://html.spec.whatwg.org/multipage/dom.html#attr-lang -->

<p>The <span title=concept-notification>notification</span>'s
<span title=concept-notification-language>language</span> specifies the primary language
for the <span title=concept-notification>notification</span>'s <span>title</span>
and <span>body</span>. Its value is a valid BCP 47 language tag, or the
empty string. The empty string indicates that the primary language is
unknown. <span data-anolis-ref>LANG</span>


<h3>Resources</h3>

<p>The <dfn>fetch steps</dfn> for a given
<span title=concept-notification>notification</span> <var title>notification</var> are:

<ol>
 <li>
  <!-- XXX https://www.w3.org/Bugs/Public/show_bug.cgi?id=24055 -->
  <p>If the notification platform supports icons,
  <span data-anolis-spec=fetch title=concept-fetch>fetch</span>
  <var title>notification</var>'s <span>icon URL</span>, if <span>icon URL</span> is set.

  <p>Then, <span data-anolis-spec=html>in parallel</span>:

  <ol>
   <li><p>Wait for the
   <span data-anolis-spec=fetch title=concept-response>response</span>.

   <li><p>If the <span data-anolis-spec=fetch title=concept-response>response</span>'s
   <span data-anolis-spec=fetch title=concept-internal-response>internal response</span>'s
   <span data-anolis-spec=fetch title=concept-response-type>type</span> is
   <i title>default</i>, attempt to decode the resource as image.

   <li><p>If the image format is supported, set <var title>notification</var>'s
   <span>icon resource</span> to the decoded resource. (Otherwise
   <var title>notification</var> has no <span>icon resource</span>.)
  </ol>

 <li>
  <p>If the notification platform supports sounds,
  <span data-anolis-spec=fetch title=concept-fetch>fetch</span>
  <var title>notification</var>'s <span>sound URL</span>, if <span>sound URL</span> is
  set.

  <p>Then, <span data-anolis-spec=html>in parallel</span>:

  <ol>
   <li><p>Wait for the
   <span data-anolis-spec=fetch title=concept-response>response</span>.

   <li><p>If the <span data-anolis-spec=fetch title=concept-response>response</span>'s
   <span data-anolis-spec=fetch title=concept-internal-response>internal response</span>'s
   <span data-anolis-spec=fetch title=concept-response-type>type</span> is
   <i title>default</i>, attempt to decode the resource as sound.
   <!-- XXX xref -->

   <li><p>If the sound format is supported, set <var title>notification</var>'s
   <span>sound resource</span> to the decoded resource. (Otherwise
   <var title>notification</var> has no <span>sound resource</span>.)
  </ol>
</ol>


<h3>Showing a notification</h3>

<p>The <dfn>show steps</dfn> for a given
<span title=concept-notification>notification</span> <var title>notification</var> are:

<ol>
 <li><p>If there is a <span title=concept-notification>notification</span>
 in the <span>list of notifications</span> whose <span>tag</span> is not the empty
 string and equals <var title>notification</var>'s <span>tag</span>, and whose
 <span title=concept-notification-origin>origin</span> is
 <span data-anolis-spec=html>same origin</span> with
 <var title>notification</var>'s <span title=concept-notification-origin>origin</span>,
 run the <span>replace steps</span> for that
 <span title=concept-notification>notification</span> and
 <var title>notification</var>, and then terminate these steps.

 <li><p>Otherwise, run the <span>display steps</span> for <var title>notification</var>.
</ol>

<h3>Activating a notification</h3>

<p>When a <span title=concept-notification>notification</span>
<var title>notification</var> is activated by the user, assuming the underlying
notification platform supports activation, the user agent must (unless otherwise
specified) run these steps:

<ol>
 <li>
  <p>If <var title>notification</var> is a
  <span title=concept-persistent-notification>persistent notification</span>, run these
  substeps:

  <ol>
   <li><p>Let <var title>callback</var> be an algorithm that when invoked with a
   <var title>global</var>,
   <span title=concept-event-fire-service-worker-notification>fires a service worker notification event</span>
   named <code title>notificationclick</code> given <var title>notification</var> on
   <var title>global</var>.

   <li><p>Then run <span data-anolis-spec=sw>Handle Functional Event</span> with
   <var title>notification</var>'s
   <span title=concept-notification-service-worker-registration>service worker registration</span>
   and <var title>callback</var>.
  </ol>

 <li>
  <p>Otherwise, <span data-anolis-spec=html>queue a task</span> to run these substeps:

  <ol>
   <li>
    <p><span data-anolis-spec=dom title=concept-event-fire>Fire an event</span> named
    <code title>click</code> with its
    <code data-anolis-spec=dom title=dom-Event-cancelable>cancelable</code> attribute
    initialized to true on the <code>Notification</code> object representing
    <var title>notification</var>.

    <p class="note no-backref">User agents are encouraged to make
    <code data-anolis-spec=html title=dom-window-focus>window.focus()</code> work from
    within the event listener for the event named <code title>click</code>.

   <li><p>If the <span data-anolis-spec=dom title=concept-event>event</span>'s
   <span data-anolis-spec=dom>canceled flag</span> is unset, the user agent should bring
   the <var title>notification</var>'s related
   <span data-anolis-spec=html>browsing context</span>'s viewport into focus.
  </ol>
</ol>

<p class=note>Throughout the web platform "activate" is intentionally misnamed as "click".


<h3>Closing a notification</h3>

<p>When a <span title=concept-notification>notification</span> is closed,
either by the underlying notification platform or by the user, the
<span>close steps</span> for it must be run.

<p>The <dfn>close steps</dfn> for a given <var title>notification</var> are:

<ol>
 <li><p>If <var title>notification</var> is not in the
 <span>list of notifications</span>, terminate these steps.

 <li><p>Remove <var title>notification</var> from the
 <span>list of notifications</span>.
</ol>


<h3>Displaying notifications</h3>

<p>The <dfn>display steps</dfn> for a given <var title>notification</var> are:

<ol>
 <li><p>Wait for any <span data-anolis-spec=fetch title=concept-fetch>fetches</span> to
 complete and <var title>notification</var>'s <span>icon resource</span> and
 <span>sound resource</span> to be set (if any).

 <li>
  <p>Display <var title>notification</var> on the device (e.g. by calling the appropriate
  notification platform).

  <p>At this point also play <var title>notification</var>'s <span>sound resource</span>,
  if any, and run <span data-anolis-spec=vibration>perform vibration</span> using
  <var title>notification</var>'s <span>vibration pattern</span>, if any.

 <li><p>Append <var title>notification</var> to the
 <span>list of notifications</span>.
</ol>


<h3>Replacing a notification</h3>

<p>The <dfn>replace steps</dfn> for replacing an <var title>old</var>
<span title=concept-notification>notification</span> with a
<var title>new</var> one are:

<ol>
 <li><p>Wait for any <span data-anolis-spec=fetch title=concept-fetch>fetches</span> to
 complete and <var title>notification</var>'s <span>icon resource</span> and
 <span>sound resource</span> to be set (if any).

 <li>
  <p>Replace <var title>old</var> with <var title>new</var>,
  in the same position, in the <span>list of notifications</span>.

  <p>If the notification platform does not support replacement this
  requirement may be addressed by running the <span>close steps</span> for
  <var title>old</var> and then running the <span>display steps</span> for
  <var title>new</var>.

  <p class=note>Notification platforms are strongly encouraged to support
  native replacement. It is much nicer.
</ol>



<h2>API</h2>

<pre class=idl>[<span title=dom-Notification>Constructor</span>(DOMString <var title>title</var>, optional <span>NotificationOptions</span> <var title>options</var>),
 Exposed=(Window,Worker)]
interface <dfn>Notification</dfn> : <span data-anolis-spec=dom>EventTarget</span> {
  static readonly attribute <span>NotificationPermission</span> <span title=dom-Notification-permission>permission</span>;
  [Exposed=Window] static void <span title=dom-Notification-requestPermission>requestPermission</span>(optional <span>NotificationPermissionCallback</span> <var title>callback</var>);

  attribute <span data-anolis-spec=html>EventHandler</span> <span title=handler-onclick>onclick</span>;
  attribute <span data-anolis-spec=html>EventHandler</span> <span title=handler-onerror>onerror</span>;

  readonly attribute DOMString <span title=dom-Notification-title>title</span>;
  readonly attribute <span>NotificationDirection</span> <span title=dom-Notification-dir>dir</span>;
  readonly attribute DOMString <span title=dom-Notification-lang>lang</span>;
  readonly attribute DOMString <span title=dom-Notification-body>body</span>;
  readonly attribute DOMString <span title=dom-Notification-tag>tag</span>;
  readonly attribute USVString <span title=dom-Notification-icon>icon</span>;
  readonly attribute USVString <span title=dom-Notification-sound>sound</span>;
  // vibrate not exposed for now; see <a href="https://www.w3.org/Bugs/Public/show_bug.cgi?id=23682" title="Fix the current [ArrayClass], [] and sequence&lt;T> mess">bug 23682</a>
  [SameObject] readonly attribute any <span title=dom-Notification-data>data</span>;

  void <span title=dom-Notification-close>close</span>();
};

dictionary <dfn>NotificationOptions</dfn> {
  <span>NotificationDirection</span> dir = "auto";
  DOMString lang = "";
  DOMString body = "";
  DOMString tag = "";
  USVString icon;
  USVString sound;
  <span data-anolis-spec=vibration>VibratePattern</span> vibrate;
  boolean renotify = false;
  boolean silent = false;
  boolean noscreen = false;
  boolean sticky = false;
  any data = null;
};

enum <dfn>NotificationPermission</dfn> {
  "default",
  "denied",
  "granted"
};

callback <dfn>NotificationPermissionCallback</dfn> = void (<span>NotificationPermission</span> <var title>permission</var>);

enum <dfn>NotificationDirection</dfn> {
  "auto",
  "ltr",
  "rtl"
};</pre>

<p>A <span title=concept-non-persistent-notification>non-persistent notification</span> is
represented one <code>Notification</code> objects and can be created through
<code>Notification</code>'s <span title=dom-Notification>constructor</span>.

<p>A <span title=concept-persistent-notification>persistent notification</span> is
represented by zero or more <code>Notification</code> objects can be created through the
<code title=dom-ServiceWorkerRegistration-showNotification>showNotification()</code>
method.


<h3>Garbage collection</h3>

<p>A <code>Notification</code> object must not be garbage collected while its
corresponding <span title=concept-notification>notification</span> is in the
<span>list of notifications</span> and the <code>Notification</code> object in
question has an
<span data-anolis-spec=dom title=concept-event-listener>event listener</span> whose
<b>type</b> is <code title>click</code> or <code title>error</code>.


<h3>Constructors</h3>

<p>The
<dfn title=dom-Notification><code>Notification(<var title>title</var>, <var title>options</var>)</code></dfn>
constructor, when invoked, must (unless otherwise indicated) run these steps:

<ol>
 <li><p>If <var title>options</var>'s <code title>sticky</code> is present,
 <span data-anolis-spec=webidl>throw</span> a <code>TypeError</code> exception.

 <li><p>If <span data-anolis-spec=html>entry settings object</span>'s
 <span data-anolis-spec=html>global object</span> is a
 <code data-anolis-spec=sw>ServiceWorkerGlobalScope</code> object,
 <span data-anolis-spec=webidl>throw</span> a <code>TypeError</code> exception.

 <li><p>Let <var title>notification</var> be the result of
 <span title="concept-notification-create">creating a notification</span> given
 <var title>title</var> and <var title>options</var>. Rethrow any exceptions.

 <li><p>Let <var title>n</var> be a new <code>Notification</code> object associated with
 <var title>notification</var>.

 <li>
  <p>Run these substeps <span data-anolis-spec=html>in parallel</span>:

  <ol>
   <li><p>If <span title=concept-permission>permission</span> for <var title>notification</var>'s
   <span title=concept-notification-origin>origin</span> is not
   "<code title>granted</code>", <span data-anolis-spec=html>queue a task</span> to
   <span data-anolis-spec=dom title=concept-event-fire>fire an event</span> named
   <code title>error</code> on <var title>n</var>, and terminate these substeps.

   <li><p>Run the <span>fetch steps</span> for <var title>notification</var>.

   <li><p>Run the <span>show steps</span> for <var title>notification</var>.
  </ol>

 <li><p>Return <var title>n</var>.
</ol>


<h3>Static members</h3>

<p>The static <dfn title=dom-Notification-permission><code>permission</code></dfn>
attribute's getter must return <span title=concept-permission>permission</span> for
<span data-anolis-spec=html>entry settings object</span>'s
<span data-anolis-spec=html>origin</span>.

<p>The static
<dfn title=dom-Notification-requestPermission><code>requestPermission(<var title>callback</var>)</code></dfn>
method, when invoked, must run these steps:

<ol>
 <li><p>Return, but continue running these steps
 <span data-anolis-spec=html>in parallel</span>.

 <li><p>Let <var title>permission</var> be
 <span title=concept-permission>permission</span> for
 <span data-anolis-spec=html>entry settings object</span>'s
 <span data-anolis-spec=html>origin</span>.

 <li><p>If <var title>permission</var> is "<code title>default</code>", ask the user
 whether showing notifications for the
 <span data-anolis-spec=html>entry settings object</span>'s
 <span data-anolis-spec=html>origin</span> is acceptable. If it is, set
 <var title>permission</var> to "<code title>granted</code>", and
 "<code title>denied</code>" otherwise.

 <li><p><span data-anolis-spec=html>Queue a task</span> to set
 <span title=concept-permission>permission</span> for
 <span data-anolis-spec=html>entry settings object</span>'s
 <span data-anolis-spec=html>origin</span> to <var title>permission</var> and invoke
 <var title>callback</var> with <var title>permission</var> as single
 argument if <var title>callback</var> is given. If this throws an exception,
 <span data-anolis-spec=html>report the exception</span>.
</ol>

<p class=warning>In designing the platform notifications are the one
instance thus far where asking the user upfront makes sense. Specifications
for other APIs should not use this pattern and instead employ one of the
<a href="http://robert.ocallahan.org/2011/06/permissions-for-web-applications_30.html">many more suitable alternatives</a>.



<h3>Object members</h3>

<p>The following are the <span data-anolis-spec=html>event handlers</span>
(and their corresponding
<span data-anolis-spec=html title="event handler event type">event handler event types</span>)
that must be supported as attributes by the <code>Notification</code> object.

<table>
 <thead>
  <tr>
   <th><span data-anolis-spec=html title="event handlers">event handler</span>
   <th><span data-anolis-spec=html>event handler event type</span>
 <tbody>
  <tr>
   <td><dfn title=handler-onclick><code>onclick</code></dfn>
   <td><code title=event-click>click</code>
  <tr>
   <td><dfn title=handler-onerror><code>onerror</code></dfn>
   <td><code title=event-error>error</code>
</table>

<p>The <dfn title=dom-Notification-close><code>close()</code></dfn> method, when invoked,
must run the <span>close steps</span> for the
<span title=concept-notification>notification</span>.

<p>The <dfn title=dom-Notification-title><code>title</code></dfn> attribute's getter must
return the <span title=concept-notification>notification</span>'s <span>title</span>.

<p>The <dfn title=dom-Notification-dir><code>dir</code></dfn> attribute's getter must
return the <span title=concept-notification>notification</span>'s
<span title=concept-notification-direction>direction</span>.

<p>The <dfn title=dom-Notification-lang><code>lang</code></dfn> attribute's getter must
return the <span title=concept-notification>notification</span>'s
<span title=concept-notification-language>language</span>.

<p>The <dfn title=dom-Notification-body><code>body</code></dfn> attribute's getter must
return the <span title=concept-notification>notification</span>'s <span>body</span>.

<p>The <dfn title=dom-Notification-tag><code>tag</code></dfn> attribute's getter must
return the <span title=concept-notification>notification</span>'s <span>tag</span>.

<p>The <dfn title=dom-Notification-icon><code>icon</code></dfn> attribute's getter must
return the <span title=concept-notification>notification</span>'s <span>icon URL</span>,
<span title=concept-url-serializer data-anolis-spec=url>serialized</span>, and the
empty string if there is no <span title=concept-notification>notification</span>'s
<span>icon URL</span> otherwise.

<p>The <dfn title=dom-Notification-sound><code>sound</code></dfn> attribute's getter must
return the <span title=concept-notification>notification</span>'s <span>sound URL</span>,
<span title=concept-url-serializer data-anolis-spec=url>serialized</span>, and the
empty string if there is no <span title=concept-notification>notification</span>'s
<span>sound URL</span> otherwise.

<p>The <dfn title=dom-Notification-data><code>data</code></dfn> attribute's getter must
return a <span data-anolis-spec=html>structured clone</span> of
<span title=concept-notification>notification</span>'s <span>data</span>.


<h3>Examples</h3>

<h4>Using events</h4>

<p><code>Notification</code> objects dispatch events during their lifecycle,
which developers can use to generate desired behaviors.

<p>The <code title=event-close>click</code> event dispatches when the user activates a
notification.

<pre class="example">var not = new Notification("Gebrünn Gebrünn by Paul Kalkbrenner", { icon: "newsong.svg", tag: "song" })
notification.onclick = function() { displaySong(this) }</pre>


<h4 id="tags-example">Using the <code title>tag</code> member for multiple instances</h4>

<p>Web applications frequently operate concurrently in multiple instances, such as when a
	user opens a mail application in multiple browser tabs.  Since the desktop is a shared
	resource, the notifications API provides a way for these instances to easily coordinate, by
	using the <code title>tag</code> member.

<p>Notifications which represent the same conceptual event can be tagged in the same way,
	and when both are shown, the user will only receive one notification.
      </p>

<pre class="example" title="">Instance 1                                   | Instance 2
                                             |
// Instance notices there is new mail.       |
new Notification("New mail from John Doe",   |
                 { tag: 'message1' });       |
                                             |
                                             |  // Slightly later, this instance notices
                                             |  // there is new mail.
                                             |  new Notification("New mail from John Doe",
                                             |                   { tag: 'message1' });</pre>

<p>The result of this situation, if the user agent follows the algorithms here, is a
<strong>single</strong> notification "New mail from John Doe".

<h4>Using the <code title>tag</code> member for a single instance</h4>

<p>The <code title>tag</code> member can also be used by a single instance of an
application to keep its notifications as current as possible as state changes.

<p>For example, if Alice is using a chat application with Bob, and Bob sends multiple
messages while Alice is idle, the application may prefer that Alice not see a desktop
notification for each message.

<pre class="example">// Bob says "Hi"
new Notification("Bob: Hi", { tag: 'chat_Bob' });

// Bob says "Are you free this afternoon?"
new Notification("Bob: Hi / Are you free this afternoon?", { tag: 'chat_Bob' });</pre>

<p>The result of this situation is a <em>single</em> notification; the second one replaces
the first having the same tag.  In a platform that queues notifications
(first-in-first-out), using the tag allows the notification to also maintain its position
in the queue.  Platforms where the newest notifications are shown first, a similar result
could be achieved using the <code title=dom-Notification-close>close()</code> method.



<h2>Service worker API</h2>

<pre class=idl>partial interface <span>Notification</span> {
  [Exposed=ServiceWorker] static Promise&lt;sequence&lt;<span>Notification</span>>> <span title=dom-Notification-get>get</span>(optional <span>GetNotificationOptions</span> <var title>filter</var>);
};

dictionary <dfn>GetNotificationOptions</dfn> {
  DOMString tag = "";
};

partial interface <span data-anolis-spec=sw>ServiceWorkerRegistration</span> {
  Promise&lt;void> <span title=dom-ServiceWorkerRegistration-showNotification>showNotification</span>(DOMString <var title>title</var>, optional <span>NotificationOptions</span> <var>options</var>);
};

[<span data-anolis-spec=dom title=concept-event-constructor>Constructor</span>(DOMString <var>type</var>, optional <span>NotificationEventInit</span> <var>eventInitDict</var>),
 Exposed=ServiceWorker]
interface <dfn>NotificationEvent</dfn> : <span data-anolis-spec=sw>ExtendableEvent</span> {
  readonly attribute <span>Notification</span> <span title=dom-NotificationEvent-notification>notification</span>;
};

dictionary <dfn>NotificationEventInit</dfn> : <span data-anolis-spec=sw>ExtendableEventInit</span> {
  required <span>Notification</span> notification;
};

partial interface <span data-anolis-spec=sw>ServiceWorkerGlobalScope</span> {
  attribute <span data-anolis-spec=html>EventHandler</span> <span title=handler-ServiceWorkerGlobalScope-onnotificationclick>onnotificationclick</span>;
};</pre>

<p>The static
<dfn title=dom-Notification-get><code>get(<var title>filter</var>)</code></dfn> method,
when invoked, must run these steps:

<ol>
 <li><p>Let <var title>promise</var> be a new promise.

 <li>
  <p>Run these substeps <span data-anolis-spec=html>in parallel</span>:

  <ol>
   <li><p>Let <var title>tag</var> be <var title>filter</var>'s <code title>tag</code>.

   <li><p>Let <var title>notifications</var> be a list of all
   <span title=concept-notification>notifications</span> in the
   <span>list of notifications</span> whose
   <span title=concept-notification-origin>origin</span> is the
   <span data-anolis-spec=html>entry settings object</span>'s
   <span data-anolis-spec=html>origin</span>, whose
   <span title=concept-notification-service-worker-registration>service worker registration</span> is
   <a href="https://github.com/slightlyoff/ServiceWorker/issues/504" class=XXX>XXX</a>,
   and whose <span>tag</span>, if <var title>tag</var> is not the empty string, is
   <var title>tag</var>.

   <li><p>Let <var title>objects</var> be an empty JavaScript array.

   <li><p>For each <span title=concept-notification>notification</span> in
   <var title>notifications</var>, in creation order, create a new
   <code>Notification</code> object representing
   <span title=concept-notification>notification</span> and push that object to
   <var title>objects</var>.

   <li><p>Resolve <var title>promise</var> with <var title>objects</var>.
  </ol>

 <li><p>Return <var title>promise</var>.
</ol>

<p class=note>This method returns zero or more new <code>Notification</code> objects which
might represent the same underlying <span title=concept-notification>notification</span>
of <code>Notification</code> objects already in existence.

<hr>

<p>The
<dfn title=dom-ServiceWorkerRegistration-showNotification><code>showNotification(<var title>title</var>, <var title>options</var>)</code></dfn>
method, when invoked, must return these steps:

<ol>
 <li><p>Let <var title>promise</var> be a new promise.

 <li><p>Let <var title>notification</var> be the result of
 <span title="concept-notification-create">creating a notification</span> given
 <var title>title</var> and <var title>options</var>. Rethrow any exceptions.

 <li><p>If <span data-anolis-spec=dom>context object</span>'s
 <span data-anolis-spec=sw>active worker</span> is null, reject <var title>promise</var>
 with a <code title>TypeError</code> exception.

 <li><p>Set <var title>notification</var>'s
 <span title=concept-notification-service-worker-registration>service worker registration</span>
 to the <span data-anolis-spec=dom>context object</span>.

 <li>
  <p>Run these substeps <span data-anolis-spec=html>in parallel</span>:

  <ol>
   <li><p>If <span title=concept-permission>permission</span> for <var title>notification</var>'s
   <span title=concept-notification-origin>origin</span> is not
   "<code title>granted</code>", reject <var title>promise</var> with a
   <code title>TypeError</code> exception, and terminate these substeps.

   <li><p>Otherwise, resolve <var title>promise</var> with undefined.

   <li><p>Run the <span>fetch steps</span> for <var title>notification</var>.

   <li><p>Run the <span>show steps</span> for <var title>notification</var>.
  </ol>

 <li><p>Return <var title>promise</var>.
</ol>

<hr>

<p>To
<dfn title=concept-event-fire-service-worker-notification>fire a service worker notification event named <var title>e</var></dfn>
given <var title>notification</var>,
<span data-anolis-spec=dom title=concept-event-fire>fire an event named <var title>e</var></span>
with an <span data-anolis-spec=dom title=concept-event>event</span> using the
<code>NotificationEvent</code> interface whose
<code title=dom-NotificationEvent-notification>notification</code> attribute
is initialized to a new <code>Notification</code> object representing
<var title>notification</var>.

<p>The
<dfn title=dom-NotificationEvent-notification><code>notification</code></dfn>
attribute's getter must return the value it was initialized to.

<p>The following is the
<span data-anolis-spec=html title="event handlers">event handler</span>
(and its corresponding <span data-anolis-spec=html>event handler event type</span>)
that must be supported as attribute by the
<code data-anolis-spec=sw>ServiceWorkerGlobalScope</code> object:

<table>
 <thead>
  <tr>
   <th><span data-anolis-spec=html title="event handlers">event handler</span>
   <th><span data-anolis-spec=html>event handler event type</span>
 <tbody>
  <tr>
   <td><dfn title=handler-ServiceWorkerGlobalScope-onnotificationclick><code>onnotificationclick</code></dfn>
   <td><code title=event-notificationclick>notificationclick</code>
</table>



<h2 class=no-num>References</h2>

<div id=anolis-references></div>



<h2 class=no-num>Acknowledgments</h2>

<p>Thanks to
Aharon (Vladimir) Lanin,
Alex Russell,
Arkadiusz Michalski,
Boris Zbarsky,
David Håsäther,
Doug Turner,
Drew Wilson,
Edward O'Connor,
Frederick Hirsch,
Ian Hickson,
Jake Archibald,
James Graham,
John Mellor,
Jon Lee,
Jonas Sicking,
Michael Henretty,
Olli Pettay,
Reuben Morais, and
Simon Pieters
for being awesome.

<p>This standard is written by
<a lang=nl href=//annevankesteren.nl/>Anne van Kesteren</a>
(<a href=//www.mozilla.org/>Mozilla</a>,
<a href=mailto:annevk@annevk.nl>annevk@annevk.nl</a>). An earlier iteration was written by
John Gregg (<a href=//www.google.com/>Google</a>,
<a href=mailto:johnnyg@google.com>johnnyg@google.com</a>).

<p>Per <a rel="license" href="//creativecommons.org/publicdomain/zero/1.0/">CC0</a>, to
the extent possible under law, the editors have waived all copyright and related or
neighboring rights to this work.

<script id=head src=//resources.whatwg.org/dfn.js></script>
